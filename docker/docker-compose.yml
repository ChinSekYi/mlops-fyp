services:
    mlflow:
      image: sychin0606/mlflow-server:latest
      platform: linux/amd64
      container_name: mlflow-server
      ports:
        - "5050:5050"   
      environment:
        MLFLOW_HOST: 0.0.0.0
        MLFLOW_PORT: 5050
      command: >
        mlflow server 
        --host 0.0.0.0 
        --port 5050 
        --allowed-hosts mlflow-server,localhost,127.0.0.1,api-con
        --default-artifact-root s3://${AWS_S3_BUCKET}/mlflow-artifacts
        --backend-store-uri ${DB_URI}
      env_file:
        - ../.env
      networks:
        - mlops-network

    api:
      image: sychin0606/fraud-api:latest
      platform: linux/amd64
      container_name: api-con
      ports:
        - "8000:8000"
      environment:
        MLFLOW_TRACKING_URI: http://mlflow-server:5050
      env_file:
        - ../.env
      networks:
        - mlops-network
      depends_on:
        - mlflow

    frontend:
      image: sychin0606/frontend:latest
      platform: linux/amd64
      container_name: frontend-con
      ports:
        - "8501:8501"
      environment:
        MODEL_SERVER_IP: http://api-con:8000
      networks:
        - mlops-network
      depends_on:
        - api

networks:
  mlops-network:
    driver: bridge

# docker compose -f docker/docker-compose.yml up

